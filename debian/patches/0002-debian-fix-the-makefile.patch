From: =?UTF-8?q?Picca=20Fr=C3=A9d=C3=A9ric-Emmanuel?= <picca@synchrotron-soleil.fr>
Date: Sun, 27 Mar 2011 10:53:01 +0200
Subject: debian fix the makefile

Make the makefile suitable for packaging.
---
 Makefile |   45 +++++++++++++++++++++++++++++++++++++--------
 1 files changed, 37 insertions(+), 8 deletions(-)

diff --git a/Makefile b/Makefile
index 7ace1c6..b5dea6e 100644
--- a/Makefile
+++ b/Makefile
@@ -15,17 +15,46 @@
 #   You should have received a copy of the GNU General Public License       
 #   along with this program.  If not, see <http://www.gnu.org/licenses/>.   
 
+
+LIB=/usr/share/lisaac
+EXAMPLE=/examples
+HTML=/html
+PDF=/pdf
+BIN=/usr/bin
+MAN=/usr/share/man/man1
+DOC=/usr/share/doc/lisaac-doc
+EMACS=/usr/share/emacs/site-lisp/lisaac-mode
+DESTDIR=
+
 CC=gcc
 CFLAGS=-O2
 
-all: install_lisaac
-	./install_lisaac
+all: bin/lisaac
+
+bin/path.h:
+	@echo "#define LISAAC_DIRECTORY \"$(LIB)\"" > bin/path.h
+
+bin/lisaac: bin/lisaac.c bin/path.h
+	$(CC) $(CFLAGS) $< -o $@
 
-install_lisaac:
-	$(CC) $(CFLAGS) install_lisaac.c -o install_lisaac
+install:
+	mkdir -p $(DESTDIR)$(LIB)
+	mkdir -p $(DESTDIR)$(BIN)
+	mkdir -p $(DESTDIR)$(MAN)
+	mkdir -p $(DESTDIR)$(DOC)$(PDF)
+	mkdir -p $(DESTDIR)$(DOC)$(EXAMPLE)
+	mkdir -p $(DESTDIR)$(EMACS)
+	cp bin/lisaac  $(DESTDIR)$(BIN)
+	cp -rf lib/  $(DESTDIR)$(LIB)
+	cp make.lip.sample $(DESTDIR)$(LIB)/make.lip
+#	this seems really too unstable to be packed
+	rm -rf $(DESTDIR)$(LIB)/lib/unstable/freetype
+	cp -rf example/* $(DESTDIR)$(DOC)$(EXAMPLE)
+	rm -rf $(DESTDIR)$(DOC)$(EXAMPLE)/shootout
+	rm -rf $(DESTDIR)$(DOC)$(EXAMPLE)/gui/clock/.avoir.txt.swp
+	cp -rf doc/man/*.gz  $(DESTDIR)$(MAN)
+	cp -rf doc/pdf/*     $(DESTDIR)$(DOC)$(PDF)
+	cp -f editor/emacs/lisaac-mode.el $(DESTDIR)$(EMACS)
 
 clean:
-	rm -f install_lisaac
-	rm -f bin/shorter.c bin/path.h bin/lisaac bin/shorter
-	rm -f src/shorter src/path.h
-	rm -rf doc/html
+	rm -f bin/path.h bin/lisaac
\ No newline at end of file
-- 
